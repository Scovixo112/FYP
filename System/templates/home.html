<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">


    <!-- Include Socket.IO client library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>

    <title>Home Page</title>
</head>
<body>
    <div class="top-box">
        <a href="{{ url_for('index') }}">Logout</a>
    </div>

    <div class="container">
        <div class="left-box">
            <!-- Left box content -->
            <img src="your-logo.png" alt="Logo">
            <div class="functions">
                <a href="{{ url_for('profile' )}}">User Profile</a>
                <a href="{{ url_for('home') }}">Home</a>
                <a href="{{ url_for('home') }}" onclick="scrollToTop()">Emergency Call</a>
                <a href="{{ url_for('community_area') }}">Community Area</a>
                <a href="{{ url_for('activities')}}">Activities</a>
            </div>
        </div>

        <!-- Right box content -->
        <div class="right-box">
            <!-- Emergency Box -->
            <div id="emergency-box">
                <!-- Add warning icon -->
                <i id="warning-icon" onmouseover="showWarningContent()">⚠️</i>
                <h3>EMERGENCY CONTACT</h3>
                <i id="edit-icon" onclick="toggleEditEmergencyForm()">✎</i>
                <p id="emergency-name">Name: <span id="emergency-name-value">{{ data.emergency_contact.name or 'N/A' }}</span></p>
                <p id="emergency-gender">Gender: <span id="emergency-gender-value">{{ data.emergency_contact.gender or 'N/A' }}</span></p>
                <p id="emergency-phone">Emergency Phone: <span id="emergency-phone-value">{{ data.emergency_contact.emergency_phone or 'N/A' }}</span></p>

                <button id="help-button" ondblclick="sendHelpMessage()">Help</button>
            </div>

            <!-- Activities Box -->
            <div id="activities-box">
                <h3>Activities</h3>
                <i id="search-icon" class="fas fa-search" onclick="goToActivitiesPage()"></i>

                <!-- Scrollable container for the activity boxes -->
                <div id="activity-scroll-container">
                    <!-- Story Box -->
                    <div class="activity-box" onclick="goToStoryPage()">
                        <h4>Story</h4>
                        <p>The emotional connection to the subject matter that stories create is powerful. 
                            Stories connect with the right hemisphere of the brain and allow us to see the bigger picture. 
                            Because of stories, we can see things in different ways. 
                            This approach can be one of the ways to help us overcome depression. 
                            This is why human therapists have learned to use stories to heal.
                        </p>
                    </div>

                    <!-- Music Box -->
                    <div class="activity-box" onclick="goToMusicPage()">
                        <h4>Music</h4>
                        <p>Dopamine and other feel-good chemicals are released into the brain when the reward system is stimulated by music, making us feel pleased. 
                            Depression symptoms may be lessened with the help of music therapy, a type of treatment that uses music to address emotional, cognitive, and social needs. 
                            One excellent method for controlling mood is music.
                        </p>
                    </div>

                    <!-- Meditation Box -->
                    <div class="activity-box" onclick="goToMeditationPage()">
                        <h4>Meditation</h4>
                        <p>Your feelings to these emotions can be altered by meditation. 
                            The goal of meditation is to become aware of these thoughts and feelings while realising that you don't have to act upon them. 
                            Close your eyes, repeat a word or phrase, or count your breaths as you allow meditation to assist you in removing yourself from stressful and unpleasant thoughts.
                        </p>
                    </div>

                    <!-- Sport Box -->
                    <div class="activity-box" onclick="goToSportPage()">
                        <h4>Sport</h4>
                        <p>Exercise releases feel-good endorphins, which improve our sense of well-being. 
                            When focused on exercise, it can help us temporarily get rid of the depressive and negative thoughts looping in our minds. 
                            Exercise can also be used to exercise our bodies to stay in shape and make us feel better about our appearance. 
                            This is also one of the best ways to help us change our negative mentality.
                        </p>
                    </div>
                </div>
            </div>
            <!--General Introduction-->
            <div id="intro-box">
                <h3>General Introduction of Application</h3>
                <p>
                    Relax is an online psychological soothing app. 
                    There are several contents which can use to relieve psychological depression and negativity. 
                    The contents include: music help, story recommendations, meditation methods and benefits, and recommended sport programs. 
                    This application also has several functions: emergency contact function, community area social function, user's todo lists function and psychological testing tools. 
                    These activities are quite simple, fun and approachable, making it a very easy-to-learn and friendly application for new users.

                    Relax is committed to helping users reduce psychological stress and negativity, bringing more peace, clarity and perspective to people's busy lives through the functions and content provided by the application. 
                    Since this is an online application, it makes it more convenient for users to use it at any time, whether at home or working away from home.
                </p>
            </div>

            <!-- Edit Emergency Form -->
            <form id="editEmergencyForm" onsubmit="saveEmergencyContact(); return false;" style="display: none;">
                <label for="edit-name">Name:</label>
                <input type="text" id="edit-name" name="name" required>
                <label for="edit-gender">Gender:</label>
                <select id="edit-gender" name="gender">
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
                <label for="edit-emergency-phone">Emergency Phone (Example: 60123456789):</label>
                <input type="tel" id="edit-emergency-phone" name="emergency_phone" pattern="[0-9]{10,}" required>
                <button type="submit">Save</button>
            </form>
        </div>
    </div>

</body>
</html>


<style>
    body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 0;
    }

    .top-box {
        background-color: #eef1f3;
        padding: 10px;
        color: #fff;
        text-align: right;
    }

    .logo {
        font-size: 24px;
        font-weight: bold;
        margin-right: 20px;
    }

    .horizontal-line {
        border-top: 1px solid #fff;
        margin-top: 5px;
        margin-bottom: 10px;
    }

    .container {
        display: flex;
        justify-content: flex-start;
        margin: 20px;
    }

    .left-box {
        width: 15%;
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

    .left-box img {
        max-width: 100%;
        border-radius: 50%;
        margin-bottom: 20px;
    }

    .functions {
        border-right: 1px solid #ccc;
        padding-right: 20px;
    }

    .functions a {
        display: block;
        color: #333;
        text-decoration: none;
        padding: 10px 0;
    }

    .functions a:hover {
        background-color: #f0f0f0;
    }

    .right-box {
        width: 80%;
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    #emergency-box {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        position: relative;
        text-align: center;
        position: relative;
    }

    #edit-icon {
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
        font-size: 20px;
        color: #007bff;
    }

    #emergency-box h3 {
        color: #721c24;
        margin-bottom: 15px;
    }

    #emergency-name, #emergency-gender, #emergency-phone {
        font-size: 16px;
        margin: 8px 0;
    }

    #editEmergencyForm {
        margin-top: 15px;
    }

    #editEmergencyForm label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }

    #editEmergencyForm input,
    #editEmergencyForm select,
    #editEmergencyForm button {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ced4da;
        border-radius: 4px;
    }

    #editEmergencyForm button {
        background-color: #007bff;
        color: #fff;
        cursor: pointer;
    }

    #editEmergencyForm button:hover {
        background-color: #0056b3;
    }

    #warning-icon {
        position: absolute;
        top: 10px;
        left: 10px;
        cursor: pointer;
        font-size: 20px;
        color: #ffc107;
    }

    #activities-box {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        position: relative;
        text-align: center;
    }

    #activities-box h3 {
        color: #28a745;
        margin-bottom: 15px;
    }

    #search-icon {
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
        font-size: 20px;
        color: #007bff;
    }

    #activity-scroll-container {
        display: flex;
        justify-content: center;  /* Center the boxes horizontally */
        overflow-x: auto;
        padding: 10px 0;
    }

    .activity-box {
        flex: 0 0 auto;
        width: 200px;
        background-color: #fff;
        border: 1px solid #ced4da;
        border-radius: 10px;
        margin-right: 10px;
        margin: 0 5px;
        padding: 10px;
        cursor: pointer;
    }

    .activity-box h4 {
        color: #007bff;
        text-align: center;
    }

    .activity-box p {
        font-size: 14px;
        color: #333;
        text-align: left;
    }

    #intro-box {
        background-color: #dce1dd;
        border: 1px solid #c3e6cb;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        position: relative;
    }

    #intro-box h3{
        text-align: center;
        font-weight: bold;
    }

    #intro-box p{
        font-size: 16px;
        color: #333;
        text-align: justify;
    }
</style>


<script>
    function scrollToTop() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }

    function showWarningContent() {
        const warningContent = `
        Please fill in the correct emergency contact information.
        Emergency contact can help users quickly contact messages.

        Use the "Help" button with caution.
        This button will trigger the skill of sending distress messages.
        To send help information, double-click the "Help" button.
    `;

        alert(warningContent);
    }

    function toggleEditEmergencyForm() {
        const form = document.getElementById('editEmergencyForm');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';

        // If the form is displayed, populate it with current values
        if (form.style.display === 'block') {
            document.getElementById('edit-name').value = document.getElementById('emergency-name-value').innerText;
            document.getElementById('edit-gender').value = document.getElementById('emergency-gender-value').innerText;
            document.getElementById('edit-emergency-phone').value = document.getElementById('emergency-phone-value').innerText;
        }
    }

    function saveEmergencyContact() {
        const formData = new FormData(document.getElementById('editEmergencyForm'));

        fetch('/update_emergency_contact_home', {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            updateEmergencyContactUI(data.emergency_contact);
            toggleEditEmergencyForm();  // Hide the form after updating
        })
        .catch(error => console.error('Error:', error));
    }

    function updateEmergencyContactUI(emergencyContact) {
        // Update the displayed emergency contact information on the page
        document.getElementById('emergency-name-value').innerText = emergencyContact.name || 'N/A';
        document.getElementById('emergency-gender-value').innerText = emergencyContact.gender || 'N/A';
        document.getElementById('emergency-phone-value').innerText = emergencyContact.emergency_phone || 'N/A';
    }

    // Send the emergency message
    const socket = io.connect('http://127.0.0.1:5000');

    function sendHelpMessage() {
        fetch('/get_user_info')
            .then(response => response.json())
            .then(data => {
                const username = data.username;
                const emergencyPhoneNumber = document.getElementById('emergency-phone-value').innerText;
            
                // Send a help message to the server
                socket.emit('send_help_message', { username, emergency_phone: emergencyPhoneNumber });
            })
            .catch(error => console.error('Error:', error));
}

    // Listen for the help message response from the server
    socket.on('receive_help_message', data => {
        const emergencyPhoneNumber = document.getElementById('emergency-phone-value').innerText;
        alert(`Message sent to ${emergencyPhoneNumber}: ${data.content}`);
    });


    function goToActivitiesPage() {
            // Handle navigation to activities page
            window.location.href = "{{ url_for('activities') }}";
        }

        function goToStoryPage() {
            // Handle navigation to story page
            window.location.href = "{{ url_for('story') }}";
        }

        function goToMusicPage() {
            // Handle navigation to music page
            window.location.href = "{{ url_for('music') }}";
        }

        function goToMeditationPage() {
            // Handle navigation to meditation page
            window.location.href = "{{ url_for('meditation') }}";
        }

        function goToSportPage() {
            // Handle navigation to sport page
            window.location.href = "{{ url_for('sport') }}";
        }
</script>



